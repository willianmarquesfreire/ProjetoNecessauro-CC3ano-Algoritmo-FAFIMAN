/******************************************************************************/
/***          Generated by IBExpert 2012.02.21 08/11/2015 12:54:35          ***/
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES UTF8;

CREATE DATABASE 'C:\Users\Erick\Desktop\ARQUIVOS DO PROJETO\APLICACAO\ERP_DATABASE.fdb'
USER 'SYSDBA' PASSWORD 'masterkey'
PAGE_SIZE 16384
DEFAULT CHARACTER SET UTF8 COLLATION UTF8;



/******************************************************************************/
/***                                 Tables                                 ***/
/******************************************************************************/



CREATE TABLE ENTREGA_MATERIA (
    EM0_COD         INTEGER NOT NULL,
    EM0_PESSOA      INTEGER NOT NULL,
    EM0_PRODUCAO    INTEGER,
    EM0_DESCRICAO   VARCHAR(30),
    EM0_DT_ENTREGA  DATE,
    EM0_EMPRESA     INTEGER NOT NULL
);

CREATE TABLE FICHA_TECNICA (
    FT_COD             INTEGER NOT NULL,
    FT_PRODUTO         VARCHAR(30) NOT NULL,
    FT_UNIDADE         INTEGER,
    FT_CUSTO_UNITARIO  NUMERIC(18,4),
    FT_MAO_DE_OBRA     NUMERIC(18,4),
    FT_QUANTIDADE      INTEGER,
    FT_CUSTO_TOTAL     NUMERIC(18,4),
    FT_TEMPO_PRODUCAO  TIMESTAMP,
    FT_EMPRESA         INTEGER NOT NULL
);

CREATE TABLE ITENS_FICHA (
    IFT_FICHA           INTEGER,
    ITF_ORDEM_PRODUCAO  INTEGER,
    IFT_PRODUTO         VARCHAR(30),
    IFT_EMPRESA         INTEGER NOT NULL,
    IFT_QTD_TOTAL       NUMERIC(18,4),
    IFT_DESCRICAO       VARCHAR(30),
    IFT_VLR_UNITARIO    NUMERIC(18,4),
    IFT_VLR_TOTAL       NUMERIC(18,4)
);

CREATE TABLE ORDEM_PRODUCAO (
    OP_VENDAS        INTEGER,
    OP_EMPRESA       INTEGER NOT NULL,
    OP_FICHATECNICA  VARCHAR(30),
    OP_DESCRICAO     VARCHAR(50),
    OP_TIPO          VARCHAR(30),
    OP_QTD           INTEGER,
    OP_DT_PEDIDO     DATE,
    OP_DT_ENTREGA    DATE,
    OP_STATUS        VARCHAR(1) default'A',
    OP_COMPRAS       INTEGER NOT NULL,
    OP_COD           INTEGER NOT NULL
);
CREATE TABLE PRODUCAO (
    PROD_ORDEM          INTEGER,
    PROD_DESCRICAO      VARCHAR(30),
    PROD_TIPO           VARCHAR(30),
    PROD_DT_INICIO      DATE,
    PROD_DT_TERMINO     DATE,
    PROD_QTD_PRODUZIDA  INTEGER,
    PROD_STATUS         VARCHAR(30),
    PROD_EMPRESA        INTEGER NOT NULL,
    PROD_COD            INTEGER NOT NULL
);
/******************************************************************************/
/***                              Primary Keys                              ***/
/******************************************************************************/

ALTER TABLE EMPRESA ADD CONSTRAINT PK_EMPRESA PRIMARY KEY (EMP_COD);
ALTER TABLE ENTREGA_MATERIA ADD CONSTRAINT PK_ENTREGA_MATERIA PRIMARY KEY (EM0_EMPRESA, EM0_COD);
ALTER TABLE FICHA_TECNICA ADD CONSTRAINT PK_FICHA PRIMARY KEY (FT_COD, FT_PRODUTO, FT_EMPRESA);
ALTER TABLE ITENS_FICHA ADD CONSTRAINT PK_ITENS PRIMARY KEY (IFT_EMPRESA);
ALTER TABLE ORDEM_PRODUCAO ADD CONSTRAINT PK_ORDEM_PRODUCAO PRIMARY KEY (OP_COD, OP_EMPRESA);
ALTER TABLE PESSOAS ADD CONSTRAINT PK_PESSOA PRIMARY KEY (PESS_CODIGO);
ALTER TABLE PRODUCAO ADD CONSTRAINT PK_PRODUCAO PRIMARY KEY (PROD_EMPRESA, PROD_COD);



/******************************************************************************/
/***                              Foreign Keys                              ***/
/******************************************************************************/

ALTER TABLE ENTREGA_MATERIA ADD CONSTRAINT FK_PESSOA FOREIGN KEY (EM0_PESSOA) REFERENCES PESSOAS (PESS_CODIGO);
ALTER TABLE ENTREGA_MATERIA ADD CONSTRAINT FK_PRODUCAO_ENTREGA FOREIGN KEY (EM0_EMPRESA, EM0_PRODUCAO) REFERENCES PRODUCAO (PROD_EMPRESA, PROD_COD);
ALTER TABLE FICHA_TECNICA ADD CONSTRAINT REL_FICHA_TECNICA_PRODUTO FOREIGN KEY (FT_EMPRESA, FT_PRODUTO) REFERENCES PRODUTOS (PRO_EMPRESA, PRO_CODIGO);
ALTER TABLE ITENS_FICHA ADD CONSTRAINT FK_ITENS_FICHA FOREIGN KEY (IFT_FICHA, IFT_PRODUTO, IFT_EMPRESA) REFERENCES FICHA_TECNICA (FT_COD, FT_PRODUTO, FT_EMPRESA);
ALTER TABLE ORDEM_PRODUCAO ADD CONSTRAINT FK_VENDA_ORDEM FOREIGN KEY (OP_EMPRESA, OP_VENDAS) REFERENCES PEDIDOVENDA (PED_EMPRESA, PED_COD);                           corrigir pois ta dando pau nas pk {{{{{{{{}}}}}}}}
ALTER TABLE PRODUCAO ADD CONSTRAINT FK_ORDEM FOREIGN KEY (PROD_ORDEM, PROD_EMPRESA) REFERENCES ORDEM_PRODUCAO (OP_COD, OP_EMPRESA);
